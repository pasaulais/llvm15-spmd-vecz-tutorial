% This program can be redistributed and/or modified under the terms
% of the GNU Public License, version 3.

\usepackage{graphicx}
\usepackage{fancyvrb}
\usepackage{tcolorbox}
\usepackage{color}
\usepackage{unicode-math}
\usepackage{fontspec}

\mode<presentation>

\DeclareOptionBeamer{secheader}{\beamer@secheadertrue}
\ProcessOptionsBeamer

\include{beamerthemecodeplaycolours}

\useoutertheme{codeplay}

% set the title color
\setbeamercolor{title}{fg=foreground}

% set colors for specific elements
\setbeamercolor{normal text}{fg=foreground}
\setbeamercolor{math text}{fg=active1}
\setbeamercolor{background canvas}{bg=background}
\setbeamercolor{structure}{fg=lightbg}
\setbeamercolor{block}{fg=foreground}
\setbeamercolor{block title}{fg=foreground}
\setbeamercolor{block item}{fg=foreground}
\setbeamercolor{section in toc}{fg=foreground}
\setbeamercolor{subsection in toc}{fg=foreground}
\setbeamercolor{section in toc shaded}{fg=lightbg}
\setbeamercolor{subsection in toc shaded}{fg=lightbg}

% Create a slide for a part.
\newcommand{\talkpart}[2]{%
\section{Part #1: #2}

\begin{frame}[c]{Part #1}

\vspace{1cm}
\centerline{\LARGE{#2}}

\end{frame}}

% Create a slide for a part section.
\newcommand{\talksection}[1]{%
\subsection{#1}
\begin{frame}{\insertsectionhead}
\vspace{2ex}
\begin{NoHyper}
\tableofcontents[sectionstyle=hide,subsectionstyle=show/shaded/hide]
\end{NoHyper}
\end{frame}}

% fonts
\usefonttheme{professionalfonts}
\setmathfont{Cambria Math}
%\setmathfont[range={\mathit}]{Cambria Math}
%\setmathfont[range={\mathup}]{Cambria Math}
\setsansfont{Calibri}
\setmonofont{Consolas}
\setbeamerfont{frametitle}{size=\LARGE,series=\bfseries}

% Code box formatting
\fvset{fontsize=\scriptsize,tabsize=4}
\tcbset{colback=darkbg,colframe=lightbg,colupper=foreground,
        left=1pt,right=1pt,top=1pt,bottom=1pt,arc=0pt,
        toprule=1pt,bottomrule=1pt,leftrule=1pt,rightrule=1pt}

\newenvironment{codebox}
 {\VerbatimEnvironment
  \begin{tcolorbox}%
  \begin{Verbatim}}
 {\end{Verbatim}\end{tcolorbox}}

% Code caption that comes after the code box.
\newcommand{\codecaption}[2][-4.4ex]{%
  \vspace{#1}
  \hfill\mbox{\footnotesize{\textcolor{active3}{#2}}\hspace{0.5em}}
  \vspace*{2ex}}

\newcommand{\sourcebox}[3][firstline=1]{%
  \begin{tcolorbox}\VerbatimInput[#1]{#2}\end{tcolorbox}
  \codecaption{#3}}

% Allows using '[]' inside a code box when command chars are enabled.
\newcommand{\idx}[1]{[#1]}

% Emphasis styles
\newcommand{\codeempha}[1]{\textcolor{active2}{#1}}
\newcommand{\codeemphb}[1]{\textcolor{active3}{#1}}

% Theme settings
\setbeamercovered{transparent}
\setbeamertemplate{itemize item}{\small\raise0.6pt\hbox{\textcolor{foreground}{\bullet}}}
\setbeamertemplate{itemize subitem}{\small\raise0.1pt\hbox{\textcolor{foreground}{\textendash}}}
\setbeamertemplate{section in toc shaded}[default][100]
\setbeamertemplate{subsection in toc shaded}[default][100]

\setbeamertemplate{subsection in toc}{%
\leavevmode\leftskip=4.00ex%
  \llap{\raisebox{0.15ex}{\textcolor{structure}{\small\textcolor{foreground}{\bullet}}}\kern1ex}%
  \inserttocsubsection\par%
}

% frame title styling
\setbeamertemplate{frametitle}{\vspace{0.4cm} \color{white}  \insertframetitle}

\setbeamersize{text margin left=2em,text margin right=2em}

% suppress navigation bar
\beamertemplatenavigationsymbolsempty

\mode
<all>
